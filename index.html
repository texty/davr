<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>rivers</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"/>
    <link rel="stylesheet" href="css/perfect-scrollbar.css">
    <link rel="stylesheet" href = "https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.9.3/introjs-rtl.min.css"/>

    <link rel="stylesheet" href = "https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.9.3/introjs.min.css"/>
    <link rel="stylesheet" href="css/styles.css">


</head>
<body>
<button id="switchToTable" class="switch" data-intro="Тисніть, аби дізнатись, які підприємстка скидають забруднену воду в річки" data-step="5">Хто забруднює річки в твоїй області</button>
<button id="switchToMap" class="switch" data-intro="Повернутись до попереднього екрану" data-step="8">Повернутись до карти</button>



<div id="clone"></div>
<div id="body" data-intro="Наведіть мишу на місце, яке хочете приблизити і покрутіть колесиком" data-step="2">
</div>
<script>
    var clonedivWidth = document.getElementById('clone').clientWidth;
    var mapWidth = document.getElementById('body').clientWidth;
    var buttonHeight = document.getElementById('switchToTable').clientHeight;
//    alert(buttonHeight)
</script>


<div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span>
        <p id="petalsData"></p>
        <div id="myModalGrid">
            <div id="chart"></div>
            <div id="big-flower">

            </div>
        </div>
    </div>
</div>

<script src="lib/jquery-2.1.4.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/colorbrewer.v1.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script src="lib/perfect-scrollbar.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.9.3/intro.min.js"></script>

<script src="js/drawBigFlower.js"></script>
<script src="js/drawChart.js"></script>
<script src="js/updateRiver.js"></script>
<script src="js/contaminants.js"></script>

<!--<script src='lib/leaflet-src.js'></script>-->
<!--<script src='https://raw.github.com/calvinmetcalf/leaflet-ajax/master/dist/leaflet.ajax.min.js'></script>-->

<!--<script src="js/leafletmap.js"></script>-->


<div id="allrivers">
    <div id="danube" class="riverCont" data-intro="Клікніть, щоб обрати басейн річки" data-step="1">
        <h5>Дунай</h5>
        <img style="width:100%" src="img/danube.png"/>
    </div>
    <div id="dnister" class="riverCont" data-intro="Щоб повернутись до попереднього масштабу, перейдіть на іншу річку" data-step="4">
        <h5>Дністер</h5>
        <img style="width:100%" src="img/dnister.png"/>
    </div>
    <div id="wisla" class="riverCont">
        <h5>Вісла</h5>
        <img style="width:100%" src="img/wisla.png"/>
    </div>
    <div id="southernbug" class="riverCont">
        <h5>Південний Буг</h5>
        <img style="width:100%" src="img/southernbug.png"/>
    </div>
    <div id="dnipro" class="riverCont">
        <h5>Дніпро</h5>
        <img style="width:100%" src="img/dnipro.png"/>
    </div>
    <div id="don" class="riverCont">
        <h5>Дон</h5>
        <img style="width:100%" src="img/don.png"/>
    </div>
</div>


<div id="regions">
    <button class="button" data-intro="Оберіть потрібну область" data-step="6">Вінницька</button>
    <button class="button">Волинська</button>
    <button class="button">Луганська</button>
    <button class="button">Дніпропетровська</button>
    <button class="button">Донецька</button>
    <button class="button">Житомирська</button>
    <button class="button">Закарпатська</button>
    <button class="button">Запорізька</button>
    <button class="button">Івано-Франківська</button>
    <button class="button">Київ</button>
    <button class="button">Київська</button>
    <button class="button">Кіровоградська</button>
    <button class="button">АР Крим</button>
    <button class="button">Львівська</button>
    <button class="button">Миколаївська</button>
    <button class="button">Одеська</button>
    <button class="button">Полтавська</button>
    <button class="button">Рівненська</button>
    <button class="button">Сумська</button>
    <button class="button">Тернопільська</button>
    <button class="button">Харківська</button>
    <button class="button">Херсонська</button>
    <button class="button">Хмельницька</button>
    <button class="button">Черкаська</button>
    <button class="button">Чернігівська</button>
    <button class="button">Чернівецька</button>

</div>

<div id="contaminants" data-intro="Чим більше забрудненої води скидає підприємство, тим вище воно в таблиці" data-ste="7"></div>


<script>


d3.select("canvas.river.danube")
      .attr("data-intro", "Кожна квіточка показує якість води в конкретній точці забору. Зелені пелюстки означають, що середнє значення показника якості в межах норми. Відтінок червоного - рівень перевищення норми. По кліку на квітку Ви зможете побачити, які показники актуальні для цієї точки і динаміку кожного за останні 5 років")
      .attr("data-step", "3");



/* perfect scroll*/

    const ps = new PerfectScrollbar('#regions', {
        wheelSpeed: 2,
        wheelPropagation: true,
        minScrollbarLength: 1
    });

    const ps2 = new PerfectScrollbar('#allrivers', {
        wheelSpeed: 2,
        wheelPropagation: true,
        minScrollbarLength: 1
    });


    /* перемикач між екранами*/

    d3.select("#switchToTable").on("click", function (){
        d3.select("#body").style("display", "none");
        d3.select("#allrivers").style("display", "none");
        d3.select("#regions").style("display", "block");
        d3.select("#contaminants").style("display", "block");
        d3.select("#switchToTable").style("display", "none");
        d3.select("#switchToMap").style("display", "block");

    });

    d3.select("#switchToMap").on("click", function (){
        d3.select("#body").style("display", "block");
        d3.select("#allrivers").style("display", "grid");
        d3.select("#regions").style("display", "none");
        d3.select("#contaminants").style("display", "none");
        d3.select("#switchToTable").style("display", "block");
        d3.select("#switchToMap").style("display", "none");

    });

    /* затримка появи річок, поки вони вантажаться*/
d3.select("#body").append("div")
        .attr("id", "loader")
//        .append("img")
//        .attr("src", "img/loading.gif");
        .append("p")
        .html("триває завантаження<span>.</span><span>.</span><span>.</span>")
        .attr("id", "wait");



    setTimeout(function () {
        introJs()
                .setOption('showBullets', false)
//                .setOption('showButtons', false)
                .setOption('nextLabel', "Далі")
                .setOption("prevLabel", "Назад")
                .setOption("skipLabel", "Пропустити інструктаж")
                .setOption("doneLabel", "Зрозуміло")


                .start();
        $('body').css('pointer-events', 'all');
        $('#loader').remove()

    }, 4000);


    /* функція фільтрує річки і квітки по обраній річці графік на різні індикатори*/
    $(".riverCont").on("click", function () {
        d3.selectAll(".riverCont").style("border", "1px solid #0d0d0d");
        d3.select(this).style("border", "2px solid white");
        var t = d3.zoomIdentity.translate(0, 0).scale(1);
        d3.select("#body").call(zoom.transform, t);

        var id = $(this).attr("id");
//        alert(id);

        var filteredArray = riversNames.filter(function (obj) {
            return obj.value === id;
        });

        d3.selectAll(".river")
                .style("display", "none")
                .each(function () {
                    var currentPath = this;
                    if (currentPath.classList.contains(filteredArray[0].value)) {
                        d3.select(currentPath).style("display", "block")
                    }
                });

        d3.selectAll(".petal")
                .style("display", "none")
                .each(function () {
                    var currentPath = this;
                    if (currentPath.classList.contains(filteredArray[0].value)) {
                        d3.select(currentPath).style("display", "block")
                    }
                });

    });




    d3.selectAll("button.button").on("click", function () {
        d3.select("table.contaminantsTable").remove();
        var key = this.innerText;
        key = key.replace(/(\r\n\t|\n|\r\t)/gm,"");
        callTable(key);
        $("table > tbody > tr#id36759156")

    });


</script>

</body>
</html>